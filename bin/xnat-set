#!/usr/bin/env python
"""
Sets variables (custom or otherwise) of a session or subject in a MBI-XNAT
project

User credentials can be stored in a ~/.netrc file so that they don't need to be
entered each time a command is run. If a new user provided or netrc doesn't
exist the tool will ask whether to create a ~/.netrc file with the given
credentials.
"""
import argparse
import re
from xnatutils import connect

parser = argparse.ArgumentParser(__doc__)
parser.add_argument('subject_or_session_id', type=str,
                    help="Name of subject or session to set the variable of")
parser.add_argument('variable', type=str,
                    help="Name of the variable to set")
parser.add_argument('value', help="Value of the variable")
args = parser.parse_args()

mbi_xnat = connect()

# Get XNAT object to set the field of
if args.subject_or_session_id.count('_') == 1:
    xnat_obj = mbi_xnat.subjects[args.subject_or_session_id]
elif args.subject_or_session_id.count('_') == 2:
    xnat_obj = mbi_xnat.experiments[args.subject_or_session_id]
else:
    raise XnatUtilsUsageError(
        "Invalid ID '{}' for subject or sessions (must contain one underscore "
        " for subjects and two underscores for sessions)"
        .format(args.subject_or_session_id))
# Set value
xnat_obj.fields[args.variable] = args.value